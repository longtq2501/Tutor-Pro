spring:
  datasource:
    url: jdbc:mysql://yamanote.proxy.rlwy.net:28075/railway
    username: root
    password: ZxcrDghnhFCiDFGmyxcNpNeDAWwkjhMC
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 25   # Railway limit
      minimum-idle: 10        # ✅ PERF: Increased from 5 for faster connection availability
      connection-timeout: 30000  # ✅ PERF: 30s timeout for busy periods
      idle-timeout: 300000
      max-lifetime: 1200000
      connection-test-query: SELECT 1
      leak-detection-threshold: 60000
      keepalive-time: 30000   # ✅ PERF: Keep connections warm

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    open-in-view: false  # ✅ PERF: Release connections immediately after transaction
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: false
        jdbc:
          batch_size: 500
          fetch_size: 100
          batch_versioned_data: true
        order_inserts: true
        order_updates: true
        default_batch_fetch_size: 20
        query:
          in_clause_parameter_padding: true

  servlet:
    multipart:
      enabled: true
      max-file-size: 100MB
      max-request-size: 100MB
      location: /tmp

  mail:
    host: smtp.gmail.com
    port: 587
    username: tonquynhlong05@gmail.com
    password: ioby qhsi cuoi lwmu
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true

app:
  mail:
    from: tonquynhlong@gmail.com
    from-name: Thầy Quỳnh Long
  init-data:
    enabled: true
    default-password: password123

feedback:
  csv:
    file-path: data/feedback_scenarios.csv
    enabled: true
    batch-size: 500
    skip-if-exists: true
  force-reimport: false
  validation:
    min-template-length: 10
    max-template-length: 1000
    require-student-placeholder: true

file:
  upload-dir: uploads

jwt:
  secret: 404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970337336763979244226452948404D635166546A576E5A7234753778214125442A
  expiration: 86400000
  refresh-expiration: 604800000

server:
  port: 8080
  error:
    include-message: always
    include-binding-errors: always
  # ✅ PERFORMANCE: Enable GZIP compression for responses
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain
    min-response-size: 1024
  tomcat:
    connection-timeout: 120000
    threads:
      max: 200
      min-spare: 20
    max-connections: 10000
    accept-count: 200

cors:
  allowed-origins: "https://tutor-management-e7zh.vercel.app,http://localhost:3000,http://localhost:5173"
  allowed-methods: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
  allowed-headers: "*"
  allow-credentials: true
  max-age: 3600

logging:
  level:
    root: INFO
    com:
      tutor_management: INFO
      tutor_management.backend.modules.feedback: INFO
    org:
      springframework:
        web: INFO
        security: WARN
        boot:
          autoconfigure: WARN
      hibernate:
        SQL: WARN
        type.descriptor.sql.BasicBinder: WARN
    com.cloudinary: INFO
    com.zaxxer.hikari: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

cloudinary:
  cloud-name: ${CLOUDINARY_CLOUD_NAME:doi1wiy3t}
  api-key: ${CLOUDINARY_API_KEY:816839713568739}
  api-secret: ${CLOUDINARY_API_SECRET:NZiSr1Kv2b3KME98NB_rWE66ybw}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
      probes:
        enabled: true
  health:
    mail:
      enabled: false
    db:
      enabled: true
    diskspace:
      enabled: true
  info:
    env:
      enabled: true
  simple:
    metrics:
      export:
        enabled: true

---
spring:
  config:
    activate:
      on-profile: dev

logging:
  level:
    com.tutor_management: DEBUG
    org.springframework.web: DEBUG
    org.hibernate.SQL: DEBUG

feedback:
  force-reimport: false  # ← Thêm dòng này

---
spring:
  config:
    activate:
      on-profile: prod

logging:
  level:
    com.tutor_management: INFO
    org.springframework: WARN

feedback:
  force-reimport: false
  csv:
    skip-if-exists: true

server:
  error:
    include-message: never
    include-binding-errors: never