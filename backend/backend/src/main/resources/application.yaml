# ✅ THÊM/UPDATE CÁC DÒNG NÀY VÀO application.yml

spring:
  datasource:
    url: jdbc:mysql://yamanote.proxy.rlwy.net:28075/railway
    username: root
    password: ZxcrDghnhFCiDFGmyxcNpNeDAWwkjhMC
    driver-class-name: com.mysql.cj.jdbc.Driver
    # ✅ HikariCP connection pool optimization
    hikari:
      maximum-pool-size: 10          # Max connections
      minimum-idle: 5                # Min idle connections
      connection-timeout: 30000      # 30s timeout
      idle-timeout: 600000           # 10 min idle
      max-lifetime: 1800000          # 30 min max lifetime
      connection-test-query: SELECT 1

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false  # ✅ TẮT để giảm log overhead
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: false  # ✅ TẮT formatting
        # ✅ Batch fetching optimization
        default_batch_fetch_size: 20
        jdbc:
          batch_size: 20
          fetch_size: 20
        order_inserts: true
        order_updates: true
        # ✅ Query optimization
        query:
          in_clause_parameter_padding: true
        # ✅ Second-level cache (optional - uncomment if needed)
        # cache:
        #   use_second_level_cache: true
        #   region:
        #     factory_class: org.hibernate.cache.jcache.JCacheRegionFactory

  servlet:
    multipart:
      enabled: true
      max-file-size: 100MB
      max-request-size: 100MB
      location: /tmp

  mail:
    host: smtp.gmail.com
    port: 587
    username: tonquynhlong05@gmail.com
    password: ioby qhsi cuoi lwmu
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true

# Application specific
app:
  mail:
    from: tonquynhlong@gmail.com
    from-name: Thầy Quỳnh Long
  init-data:
    enabled: true
    default-password: password123

# File storage
file:
  upload-dir: uploads

# JWT
jwt:
  secret: 404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970337336763979244226452948404D635166546A576E5A7234753778214125442A
  expiration: 86400000
  refresh-expiration: 604800000

# Server
server:
  port: 8080
  error:
    include-message: always
    include-binding-errors: always
  # ✅ Tomcat optimization
  tomcat:
    connection-timeout: 120000      # 2 min for large uploads
    threads:
      max: 200                      # Max threads
      min-spare: 10                 # Min spare threads

# CORS
cors:
  allowed-origins: "https://tutor-management-e7zh.vercel.app,http://localhost:3000,http://localhost:5173"
  allowed-methods: "GET,POST,PUT,DELETE,OPTIONS"
  allowed-headers: "*"
  allow-credentials: true

# Logging
logging:
  level:
    com:
      tutor_management: INFO       # ✅ Giảm từ DEBUG → INFO
    org:
      springframework:
        web: INFO                   # ✅ Giảm log
        security: WARN
      hibernate: WARN                # ✅ Giảm Hibernate logs
    com.cloudinary: INFO

# Cloudinary
cloudinary:
  cloud-name: ${CLOUDINARY_CLOUD_NAME:doi1wiy3t}
  api-key: ${CLOUDINARY_API_KEY:816839713568739}
  api-secret: ${CLOUDINARY_API_SECRET:NZiSr1Kv2b3KME98NB_rWE66ybw}

management:
  health:
    mail:
      enabled: false  # ✅ Tắt kiểm tra mail để không bị lỗi treo khi khởi động
  endpoints:
    web:
      exposure:
        include: health, info  # ✅ Cho phép UptimeRobot xem trạng thái